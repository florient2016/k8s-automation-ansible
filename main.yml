---
- name: Deploy NGINX webinar page via NodePort
  hosts: localhost
  gather_facts: false
  vars:
    namespace: aap-deploy
  tasks:
    - name: Apply Kubernetes resources (Namespace, ConfigMap, Deployment, NodePort Service)
      kubernetes.core.k8s:
        state: present
        definition:

          # 1) Namespace
          - apiVersion: v1
            kind: Namespace
            metadata:
              name: "{{ namespace }}"

          # 2) ConfigMap ‚Äì custom NGINX web page
          - apiVersion: v1
            kind: ConfigMap
            metadata:
              name: nginx-index
              namespace: "{{ namespace }}"
            data:
              index.html: |
                <!DOCTYPE html>
                <html lang="fr">
                <head>
                  <meta charset="UTF-8" />
                  <title>Webinaire ‚Äî Gouverner l‚Äôautomatisation √† grande √©chelle</title>
                  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
                
                  <style>
                    :root{
                      --bg:#0b0e14;
                      --panel:#121827;
                      --panel2:#0f1422;
                      --text:#ffffff;
                      --muted:#a1a1aa;
                      --green:#22c55e;
                      --blue:#4f46e5;
                      --border:rgba(255,255,255,.08);
                      --shadow: 0 30px 90px rgba(0,0,0,.55);
                    }
                
                    *{ box-sizing:border-box; }
                    body{
                      margin:0;
                      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
                      color:var(--text);
                      background:
                        radial-gradient(900px 450px at 20% 0%, rgba(79,70,229,.22), transparent 55%),
                        radial-gradient(900px 450px at 80% 10%, rgba(34,197,94,.20), transparent 55%),
                        radial-gradient(circle at top, #111827, var(--bg));
                      line-height:1.6;
                    }
                
                    .container{
                      max-width:1200px;
                      margin:0 auto;
                      padding:42px 20px 70px;
                    }
                
                    /* TOP BAR */
                    .topbar{
                      display:flex;
                      align-items:center;
                      justify-content:space-between;
                      gap:16px;
                      margin-bottom:26px;
                    }
                    .brand{
                      display:flex;
                      align-items:center;
                      gap:10px;
                      font-weight:700;
                      letter-spacing:.2px;
                    }
                    .dot{
                      width:12px;height:12px;border-radius:999px;
                      background:linear-gradient(135deg, var(--blue), var(--green));
                      box-shadow:0 0 0 6px rgba(79,70,229,.12);
                    }
                    .pill{
                      display:inline-flex;
                      align-items:center;
                      gap:10px;
                      padding:8px 14px;
                      border:1px solid var(--border);
                      border-radius:999px;
                      background:rgba(0,0,0,.18);
                      color:var(--muted);
                      font-size:13px;
                      white-space:nowrap;
                    }
                    .live{
                      width:8px;height:8px;border-radius:99px;
                      background:#ef4444;
                      box-shadow:0 0 0 6px rgba(239,68,68,.12);
                    }
                
                    /* HERO */
                    .hero{
                      display:grid;
                      grid-template-columns: 1.1fr .9fr;
                      gap:34px;
                      align-items:stretch;
                    }
                
                    .hero-left{
                      padding:28px 28px 30px;
                      border:1px solid var(--border);
                      border-radius:18px;
                      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
                      backdrop-filter: blur(6px);
                    }
                
                    .kickers{
                      display:flex;
                      flex-wrap:wrap;
                      gap:10px;
                      margin-bottom:14px;
                    }
                    .tag{
                      display:inline-flex;
                      align-items:center;
                      padding:7px 12px;
                      border-radius:999px;
                      font-size:12px;
                      border:1px solid var(--border);
                      background:rgba(0,0,0,.18);
                      color:var(--muted);
                    }
                    .tag.green{
                      border-color: rgba(34,197,94,.35);
                      background: rgba(34,197,94,.12);
                      color:#bff7d1;
                    }
                
                    h1{
                      margin:10px 0 12px;
                      font-size:44px;
                      line-height:1.12;
                      letter-spacing:-.6px;
                    }
                    h1 .hl{
                      color:var(--green);
                    }
                    .lead{
                      margin:0 0 18px;
                      color:var(--muted);
                      font-size:17px;
                      max-width:58ch;
                    }
                
                    .cta-row{
                      display:flex;
                      flex-wrap:wrap;
                      gap:12px;
                      margin-top:18px;
                      align-items:center;
                    }
                    .btn{
                      display:inline-flex;
                      align-items:center;
                      justify-content:center;
                      gap:10px;
                      padding:12px 16px;
                      border-radius:12px;
                      border:1px solid var(--border);
                      background:rgba(255,255,255,.03);
                      color:var(--text);
                      text-decoration:none;
                      font-weight:600;
                      cursor:pointer;
                    }
                    .btn.primary{
                      border-color: rgba(34,197,94,.45);
                      background: linear-gradient(135deg, rgba(34,197,94,.20), rgba(79,70,229,.14));
                    }
                    .btn:hover{ filter:brightness(1.06); }
                
                    .note{
                      font-size:13px;
                      color:var(--muted);
                    }
                
                    .hero-right{
                      border-radius:18px;
                      overflow:hidden;
                      border:1px solid var(--border);
                      background:var(--panel2);
                      box-shadow:var(--shadow);
                      position:relative;
                      min-height:360px;
                    }
                    .hero-right img{
                      width:100%;
                      height:100%;
                      object-fit:cover;
                      display:block;
                      filter:saturate(1.05) contrast(1.02);
                      transform: scale(1.01);
                    }
                    .hero-right .overlay{
                      position:absolute;
                      inset:0;
                      background:
                        linear-gradient(180deg, rgba(11,14,20,.15), rgba(11,14,20,.75));
                      pointer-events:none;
                    }
                    .hero-right .stamp{
                      position:absolute;
                      left:16px;
                      bottom:16px;
                      display:inline-flex;
                      gap:10px;
                      align-items:center;
                      padding:10px 12px;
                      border-radius:14px;
                      border:1px solid var(--border);
                      background:rgba(0,0,0,.35);
                      backdrop-filter: blur(6px);
                      font-size:13px;
                      color:#e5e7eb;
                    }
                    .stamp b{ color: #ffffff; }
                    .stamp span{ color: var(--muted); }
                
                    /* INFO CARDS */
                    .cards{
                      margin-top:22px;
                      display:grid;
                      grid-template-columns: repeat(3, 1fr);
                      gap:14px;
                    }
                    .card{
                      border:1px solid var(--border);
                      border-radius:16px;
                      background:rgba(255,255,255,.03);
                      padding:16px 16px 14px;
                    }
                    .card .label{
                      color:var(--muted);
                      font-size:12px;
                      margin-bottom:4px;
                    }
                    .card .value{
                      font-size:18px;
                      font-weight:700;
                    }
                    .card .value .tz{
                      color:var(--muted);
                      font-weight:600;
                      font-size:13px;
                      margin-left:6px;
                    }
                
                    /* SECTIONS */
                    .grid{
                      margin-top:26px;
                      display:grid;
                      grid-template-columns: 1.1fr .9fr;
                      gap:14px;
                    }
                    .panel{
                      border:1px solid var(--border);
                      border-radius:18px;
                      background:rgba(255,255,255,.03);
                      padding:18px 18px 16px;
                    }
                    .panel h2{
                      margin:0 0 10px;
                      font-size:18px;
                      letter-spacing:-.2px;
                    }
                    ul{
                      margin:10px 0 0;
                      padding-left:18px;
                      color:var(--muted);
                    }
                    li{ margin:7px 0; }
                
                    /* SPEAKERS */
                    .speakers{
                      margin-top:18px;
                      display:grid;
                      grid-template-columns: repeat(2, 1fr);
                      gap:14px;
                    }
                    .speaker{
                      border:1px solid var(--border);
                      border-radius:18px;
                      background:rgba(255,255,255,.03);
                      padding:18px;
                      display:flex;
                      gap:14px;
                      align-items:flex-start;
                    }
                    .avatar{
                      width:52px;height:52px;border-radius:999px;
                      display:grid;place-items:center;
                      font-weight:800;
                      background:linear-gradient(135deg, rgba(79,70,229,.35), rgba(34,197,94,.25));
                      border:1px solid rgba(255,255,255,.12);
                      flex: 0 0 auto;
                    }
                    .speaker h3{
                      margin:0;
                      font-size:16px;
                    }
                    .speaker p{
                      margin:6px 0 0;
                      color:var(--muted);
                      font-size:13px;
                    }
                
                    footer{
                      margin-top:22px;
                      padding-top:18px;
                      border-top:1px solid var(--border);
                      color:var(--muted);
                      font-size:13px;
                      display:flex;
                      flex-wrap:wrap;
                      justify-content:space-between;
                      gap:10px;
                    }
                
                    @media (max-width: 980px){
                      .hero{ grid-template-columns:1fr; }
                      .hero-right{ min-height:260px; }
                      .cards{ grid-template-columns:1fr; }
                      .grid{ grid-template-columns:1fr; }
                      .speakers{ grid-template-columns:1fr; }
                      h1{ font-size:38px; }
                    }
                  </style>
                </head>
                
                <body>
                  <div class="container">
                
                    <div class="topbar">
                      <div class="brand">
                        <span class="dot"></span>
                        <span>TeachMeMore</span>
                      </div>
                      <div class="pill"><span class="live"></span> Webinaire en direct</div>
                    </div>
                
                    <section class="hero">
                      <div class="hero-left">
                        <div class="kickers">
                          <span class="tag">S√©rie : Op√©rations & Production</span>
                          <span class="tag green">Formation gratuite</span>
                        </div>
                
                        <h1>
                          Gouverner l‚Äô<span class="hl">automatisation</span><br/>
                          quand tout passe √† l‚Äô√©chelle
                        </h1>
                
                        <p class="lead">
                          Quand les scripts et pipelines se multiplient, les risques aussi : incoh√©rences, d√©pendances,
                          difficult√©s d‚Äôaudit, et d√©ploiements qui deviennent impr√©visibles. Dans ce webinaire, on montre
                          une approche op√©rationnelle pour standardiser, s√©curiser et piloter l‚Äôautomatisation en environnement r√©el.
                        </p>
                
                        <div class="cta-row">
                          <a class="btn primary" href="#" aria-label="Lien d'inscription">
                            ‚úÖ Je m‚Äôinscris (lien √† remplacer)
                          </a>
                          <a class="btn" href="#programme">üìå Voir le programme</a>
                          <span class="note">Dur√©e : ~60 min + Q/R</span>
                        </div>
                
                        <div class="cards" aria-label="Informations pratiques">
                          <div class="card">
                            <div class="label">Date</div>
                            <div class="value">08 janvier 2026</div>
                          </div>
                          <div class="card">
                            <div class="label">Heure</div>
                            <div class="value">21h00 <span class="tz">(Paris)</span></div>
                          </div>
                          <div class="card">
                            <div class="label">Format</div>
                            <div class="value">En ligne ‚Ä¢ Live</div>
                          </div>
                        </div>
                      </div>
                
                      <!-- HERO IMAGE (miniature.jpeg) -->
                      <div class="hero-right" aria-label="Visuel du webinaire">
  
                        <div class="overlay"></div>
                        <div class="stamp">
                          <b>Acc√®s gratuit</b> <span>‚Ä¢ Inscription requise</span>
                        </div>
                      </div>
                    </section>
                
                    <section class="grid" id="programme">
                      <div class="panel">
                        <h2>Ce que vous allez apprendre</h2>
                        <ul>
                          <li>Identifier les signaux d‚Äôun ‚Äúmur d‚Äôautomatisation‚Äù (duplication, dette, d√©pendances humaines).</li>
                          <li>Structurer des automatisations r√©utilisables (patterns, standards, bonnes pratiques d‚Äô√©quipe).</li>
                          <li>Mettre en place une gouvernance pragmatique : tra√ßabilit√©, audit, r√¥les et r√®gles.</li>
                          <li>Industrialiser l‚Äôex√©cution en production : fiabilit√©, contr√¥le, visibilit√©, gestion du changement.</li>
                        </ul>
                      </div>
                
                      <div class="panel">
                        <h2>Pour qui ?</h2>
                        <ul>
                          <li>DevOps, Ops, SRE, Cloud & Platform engineers</li>
                          <li>Tech leads & responsables industrialisation</li>
                          <li>√âquipes souhaitant passer du ‚Äúbricolage utile‚Äù √† une pratique durable</li>
                        </ul>
                      </div>
                    </section>
                
                    <section class="panel" style="margin-top:14px;">
                      <h2>Agenda du webinaire</h2>
                      <ul>
                        <li>‚Äî contexte : pourquoi l‚Äôautomatisation ralentit quand elle se disperse</li>
                        <li>‚Äî principes : standardisation, r√©utilisation, s√©paration des responsabilit√©s</li>
                        <li>‚Äî op√©ration : ex√©cution contr√¥l√©e, visibilit√©, gestion des acc√®s, audit</li>
                        <li>‚Äî questions/r√©ponses</li>
                      </ul>
                    </section>
                
                    <section class="speakers" aria-label="Intervenants">
                      <div class="speaker">
                        <div class="avatar">FD</div>
                        <div>
                          <h3>Florient Dogbe</h3>
                          <p>
                            Consultant DevOps/Cloud ‚Ä¢ Certifications : RHCA-level VI, RHCOA, CKAD, CKA,
                            Terraform, Azure, CEH (et +).
                          </p>
                        </div>
                      </div>
                
                      <div class="speaker">
                        <div class="avatar">AN</div>
                        <div>
                          <h3>Armel Ngando</h3>
                          <p>
                            Fondateur TeachMeMore ‚Ä¢ Formation & accompagnement autour des pratiques
                            d‚Äôindustrialisation, automatisation et delivery en production.
                          </p>
                        </div>
                      </div>
                    </section>
                
                    <footer>
                      <div>¬© 2026 TeachMeMore</div>
                    </footer>
                
                  </div>
                </body>
                </html>



          # 3) Deployment
          - apiVersion: apps/v1
            kind: Deployment
            metadata:
              name: nginx
              namespace: "{{ namespace }}"
              labels:
                app: nginx
            spec:
              replicas: 2
              selector:
                matchLabels:
                  app: nginx
              template:
                metadata:
                  labels:
                    app: nginx
                spec:
                  containers:
                    - name: nginx
                      image: nginx:1.25
                      ports:
                        - containerPort: 80
                      volumeMounts:
                        - name: web-content
                          mountPath: /usr/share/nginx/html/index.html
                          subPath: index.html
                  volumes:
                    - name: web-content
                      configMap:
                        name: nginx-index

          # 4) NodePort Service
          - apiVersion: v1
            kind: Service
            metadata:
              name: nginx
              namespace: "{{ namespace }}"
            spec:
              type: NodePort
              selector:
                app: nginx
              ports:
                - name: http
                  port: 80
                  targetPort: 80
                  nodePort: 30080   # optional; must be within 30000‚Äì32767
        
        # kubectl command to port-forward:
        # kubectl -n "{{ namespace }}" port-forward svc/nginx 8080:
    #- name: kubectl port-forward
    #  ansible.builtin.command: >
    #    kubectl -n "{{ namespace }}" port-forward svc/nginx 8087:80
    #  register: port_forward_result

    #- name: Display port-forward result
    #  ansible.builtin.debug:
    #    var: port_forward_result.stdout
    #  